package matching_rules

import "class://com.google.cloud.verticals.foundations.dataharmonization.plugins.reconciliation.ReconciliationPlugin"

def PersonConfig() {
  recon::anyOf(
    recon::allOf(
      recon::anyMetaExtension(
        recon::filterField("url", "urn:oid:google/empi-person"),
        recon::filterField("valueString", "person-purpose")
      ),
      recon::arrayAnyOf("identifier",
        recon::allOf(
          recon::filterField("system", ReadPipelinePersonEMPISystemEnvVar()),
          recon::primitive("value")
        )
      )
    )
  )
}